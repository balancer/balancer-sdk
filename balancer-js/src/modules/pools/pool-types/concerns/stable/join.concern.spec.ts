import { expect } from 'chai';
import { StablePoolJoin } from './join.concern';

import pools_14717479 from '@/test/lib/pools_14717479.json';
import { parseFixed } from '@ethersproject/bignumber';

const dai_usdc_usdt_pool_id =
  '0x06df3b2bbb68adc8b0e302443692037ed9f91b42000000000000000000000063'; // Balancer USD Stable Pool - staBAL3

const DAI_address = '0x6b175474e89094c44da98b954eedeac495271d0f'; // 18
const USDC_address = '0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48'; // 6
const USDT_address = '0xdac17f958d2ee523a2206206994597c13d831ec7'; // 6
const wrappedNativeAsset = '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2';

const pool = pools_14717479.find(
  (pool) => pool.id == dai_usdc_usdt_pool_id
) as unknown as Pool;

const concern = new StablePoolJoin();

describe('joining stable pool', () => {
  describe('.buildJoin', async () => {
    it('should return encoded params', async () => {
      const joiner = '0x35f5a330fd2f8e521ebd259fa272ba8069590741';
      const tokensIn = [DAI_address, USDC_address, USDT_address];
      const amountsIn = [
        parseFixed('100', 18).toString(),
        parseFixed('100', 6).toString(),
        parseFixed('100', 6).toString(),
      ];
      const slippage = '100';
      const { data } = concern.buildJoin({
        joiner,
        pool,
        tokensIn,
        amountsIn,
        slippage,
        wrappedNativeAsset,
      });

      expect(data).to.equal(
        '0xb95cac2806df3b2bbb68adc8b0e302443692037ed9f91b4200000000000000000000006300000000000000000000000035f5a330fd2f8e521ebd259fa272ba806959074100000000000000000000000035f5a330fd2f8e521ebd259fa272ba80695907410000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec700000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000005f5e1000000000000000000000000000000000000000000000000000000000005f5e10000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000100116b8372224147e00000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000005f5e1000000000000000000000000000000000000000000000000000000000005f5e100'
      );
    });
  });
});
